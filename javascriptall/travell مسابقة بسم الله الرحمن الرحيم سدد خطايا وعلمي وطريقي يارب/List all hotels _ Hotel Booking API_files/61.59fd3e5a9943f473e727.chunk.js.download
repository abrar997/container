(self.webpackJsonp=self.webpackJsonp||[]).push([[61],{3171:function(t,e,r){"use strict";r.r(e),r.d(e,"ProjectRegistry",(function(){return l})),r.d(e,"getProjectRegistry",(function(){return d}));var n=r(380),o=r(3453),i=r(59),a=r(879),c=r(3327),s=r(877);const u=new WeakMap;const p=(t,e=0,r)=>{const n=function(t){let e=u.get(t);return void 0===e&&(e=new Map,u.set(t,e)),e}(t);return(...o)=>{let i=n.get(o[0]);void 0===i&&(i=Object(s.debounce)(t,e,r),n.set(o[0],i)),i(...o)}};class l extends n.EventEmitter{constructor(){super(...arguments),this.appCache=Object(c.a)(),this._reactions=new n.DisposableCollection,this._projectUpdated=p((t,e)=>{this.emit("updated",e)},1500),this.upsertProject=Object(i.flow)((function*(t){yield this.ensureActivated();const e=this.appCache.projects[t.id],r=Object.assign(Object.assign({},e),t);return(null==e?void 0:e.cwd)&&(r.cwd=e.cwd),this.appCache.projects[t.id]=r,e?this.emit("updated",r):this.emit("added",r),t})).bind(this),this.deleteProject=Object(i.flow)((function*(t){yield this.ensureActivated();const e=this.appCache.projects[t];delete this.appCache.projects[t],console.log(`deleting database SL.${t}...`);try{yield Promise.race([Object(o.a)("SL."+t),new Promise((t,e)=>{setTimeout(()=>e(new Error("Project failed to remove within a second")),1e3)})])}finally{return console.log("deleted"),this.emit("removed",Object(i.toJS)(e)),e}})).bind(this)}async ensureActivated(){var t;"deactivated"===this.appCache.state?await this.appCache.activate():"isActivating"===this.appCache.state&&await new Promise(t=>Object(i.when)(()=>"activated"===this.appCache.state,()=>t())),null===(t=this._reactions)||void 0===t||t.dispose(),this._reactions.push(Object(n.createDisposable)(Object(i.observe)(this.appCache.projects,t=>{"update"===t.type&&this._projectUpdated(String(t.name),Object(i.toJS)(t.object[t.name]))})))}async listProjects(){return await this.ensureActivated(),Object.values(this.appCache.projects||{})}async migrateToWebProject(t,e,n,o){const{migrateToWebProject:i}=await Promise.all([r.e(0),r.e(1),r.e(3),r.e(2),r.e(6),r.e(8),r.e(5),r.e(32)]).then(r.bind(null,4318));return await this.ensureActivated(),i(this.appCache.projects[t],e,n,o)}async downloadZipOfProject(t){const{downloadZipFile:e}=await Promise.all([r.e(0),r.e(1),r.e(3),r.e(2),r.e(6),r.e(8),r.e(5),r.e(32)]).then(r.bind(null,4318));await this.ensureActivated();const n=this.appCache.projects[t];await e(n)}createUntitledProjectName(){return"untitled-"+Object(a.a)("123456789",7)()}isUntitledProjectName(t){return/untitled-\d{7}/.test(t)}}let f;const d=()=>(f||(f=new l),f)},3214:function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));var n=r(204);let o=Object(n.getReporter)();if(!o)throw new Error("Missing a @stoplight/reporter");const i=o},3224:function(t,e,r){"use strict";function n(t){return null!=t&&"object"==typeof t}function o(t){return"function"!=typeof t&&!n(t)}function i(t){if(!0===o(t))return!1;const e=Object.getPrototypeOf(t);return null===e||e===Object.prototype}function a(t){return null!=t}r.d(e,"b",(function(){return n})),r.d(e,"d",(function(){return o})),r.d(e,"c",(function(){return i})),r.d(e,"a",(function(){return a}))},3251:function(t,e,r){"use strict";t.exports=function(){if("function"!=typeof Promise)throw new TypeError("`Promise.allSettled` requires a global `Promise` be available.")}},3268:function(t,e,r){"use strict";r.d(e,"a",(function(){return o}));var n=r(3214);const o=(t,e)=>{const r=setInterval(async()=>{try{await t()}catch(t){t.extra={trigger:"createDisposableInterval"},n.a.error(t)}},e),o={dispose:()=>{clearInterval(r),o.dispose=()=>{}}};return o}},3269:function(t,e,r){"use strict";r.d(e,"a",(function(){return a}));var n=r(3166),o=r(380),i=r(59);class a extends o.Activatable{constructor(){super(...arguments),this.__state="deactivated"}get _state(){return this.__state}set _state(t){this.__state=t}}Object(n.d)([i.observable],a.prototype,"__state",void 0),Object(n.d)([i.computed],a.prototype,"_state",null)},3302:function(t,e,r){"use strict";var n=r(634),o=r(315),i=r(3251),a=r(3303),c=r(3307),s=r(3372);i();var u=n.call(Function.call,c()),p=function(t){return u(void 0===this?Promise:this,t)};o(p,{getPolyfill:c,implementation:a,shim:s}),t.exports=p},3303:function(t,e,r){"use strict";r(3251)();var n=r(3173),o=r(114),i=r(3363),a=r(3369),c=r(62),s=r(634),u=s.call(Function.call,c("%Promise_all%")),p=s.call(Function.call,c("%Promise_reject%"));t.exports=function(t){var e=this;if("Object"!==o(e))throw new TypeError("`this` value must be an object");var r=i(t);return u(e,a(r,(function(t){var r=n(e,t);try{return r.then((function(t){return{status:"fulfilled",value:t}}),(function(t){return{status:"rejected",reason:t}}))}catch(t){return p(e,t)}})))}},3304:function(t,e,r){"use strict";var n=String.prototype.valueOf,o=Object.prototype.toString,i="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;t.exports=function(t){return"string"==typeof t||"object"==typeof t&&(i?function(t){try{return n.call(t),!0}catch(t){return!1}}(t):"[object String]"===o.call(t))}},3305:function(t,e,r){"use strict";var n=r(3174),o=r(456),i=r(1441),a=r(384),c=r(3175),s=r(383),u=r(3176),p=r(1440),l=r(1442),f=r(231),d=r(3304),h=Object("a"),v="a"!==h[0]||!(0 in h),y=f("String.prototype.split");t.exports=function(t){var e,r=p(this),f=v&&d(r)?y(r,""):r,h=u(f.length);if(!s(t))throw new TypeError("Array.prototype.map callback must be a function");arguments.length>1&&(e=arguments[1]);for(var b=n(r,h),j=0;j<h;){var g=l(j),m=c(r,g);if(m){var w=a(r,g),S=o(t,e,[w,j,r]);i(b,g,S)}j+=1}return b}},3306:function(t,e,r){"use strict";var n=r(3370),o=r(3305);t.exports=function(){var t=Array.prototype.map;return n(t)?t:o}},3307:function(t,e,r){"use strict";var n=r(3251),o=r(3303);t.exports=function(){return n(),"function"==typeof Promise.allSettled?Promise.allSettled:o}},3327:function(t,e,r){"use strict";r.d(e,"a",(function(){return h}));var n=r(3166),o=r(55),i=r(380),a=r(59),c=r(3302),s=r(3268),u=r(3224),p=r(3269);function l(){const t=Object(o.safeParse)(localStorage.SL);return{config:Object(u.b)(null==t?void 0:t.config)?t.config:{},projects:Object(u.b)(null==t?void 0:t.projects)?t.projects:{}}}class f extends p.a{constructor(){super(),this._activeDisposables=new i.DisposableCollection,this.doActivate=Object(a.flow)(function*(){yield async function(){if(localStorage.SL)return;let t;({openDB:t}=await r.e(4).then(r.bind(null,3627)));const e=await t("SL",1,{upgrade(t,e,r){1===r&&(t.createObjectStore("config"),t.createObjectStore("projects"))}}),n=await e.transaction(["config","projects"],"readwrite"),i={config:{},projects:{}};for(const t of n.objectStoreNames){const e=await n.objectStore(t),r=await e.getAllKeys();await c(r.map(async r=>{i[t][String(r)]=await e.get(r)}))}return localStorage.SL=Object(o.safeStringify)(i),void c(Array.from(n.objectStoreNames).map(async t=>{const e=await n.objectStore(t);await e.clear()})).catch(t=>{console.error("Failed to clean idb stores",t)})}(),this._storage=l(),this._activeDisposables=new i.DisposableCollection,this._activeDisposables.push(Object(s.a)(this._saveStorage,5e3))}.bind(this)),this._saveStorage=()=>{localStorage.SL=Object(o.stringify)(this._storage)},this._storage=l()}get config(){return this._storage.config}get projects(){return this._storage.projects}async doDeactivate(){this._saveStorage(),this._activeDisposables.dispose()}}let d;Object(n.d)([a.observable],f.prototype,"_storage",void 0),Object(n.d)([a.computed],f.prototype,"config",null),Object(n.d)([a.computed],f.prototype,"projects",null);const h=()=>(d||(d=new f),d)},3363:function(t,e,r){"use strict";var n=r(3364),o=TypeError,i=r(3368);t.exports=function(t){var e=n(t);if(!e)throw new o("non-iterable value provided");return arguments.length>1?i(e,arguments[1]):i(e)}},3364:function(t,e,r){"use strict";(function(e){var n=r(1443);if(r(638)()||r(1439)()){var o=Symbol.iterator;t.exports=function(t){return null!=t&&void 0!==t[o]?t[o]():n(t)?Array.prototype[o].call(t):void 0}}else{var i=r(3365),a=r(3304),c=r(62),s=c("%Map%",!0),u=c("%Set%",!0),p=r(231),l=p("Array.prototype.push"),f=p("String.prototype.charCodeAt"),d=p("String.prototype.slice"),h=function(t){var e=0;return{next:function(){var r,n=e>=t.length;return n||(r=t[e],e+=1),{done:n,value:r}}}},v=function(t){if(i(t)||n(t))return h(t);if(a(t)){var e=0;return{next:function(){var r=function(t,e){if(e+1>=t.length)return e+1;var r=f(t,e);if(r<55296||r>56319)return e+1;var n=f(t,e+1);return n<56320||n>57343?e+1:e+2}(t,e),n=d(t,e,r);return e=r,{done:r>t.length,value:n}}}}};if(s||u){var y=r(3366),b=r(3367),j=p("Map.prototype.forEach",!0),g=p("Set.prototype.forEach",!0);if(void 0===e||!e.versions||!e.versions.node)var m=p("Map.prototype.iterator",!0),w=p("Set.prototype.iterator",!0),S=function(t){var e=!1;return{next:function(){try{return{done:e,value:e?void 0:t.next()}}catch(t){return e=!0,{done:!0,value:void 0}}}}};var O=p("Map.prototype.@@iterator",!0)||p("Map.prototype._es6-shim iterator_",!0),_=p("Set.prototype.@@iterator",!0)||p("Set.prototype._es6-shim iterator_",!0);t.exports=function(t){return function(t){if(y(t)){if(m)return S(m(t));if(O)return O(t);if(j){var e=[];return j(t,(function(t,r){l(e,[r,t])})),h(e)}}if(b(t)){if(w)return S(w(t));if(_)return _(t);if(g){var r=[];return g(t,(function(t){l(r,t)})),h(r)}}}(t)||v(t)}}else t.exports=v}}).call(this,r(52))},3365:function(t,e){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},3366:function(t,e,r){"use strict";var n,o="function"==typeof Map&&Map.prototype?Map:null,i="function"==typeof Set&&Set.prototype?Set:null;o||(n=function(t){return!1});var a=o?Map.prototype.has:null,c=i?Set.prototype.has:null;n||a||(n=function(t){return!1}),t.exports=n||function(t){if(!t||"object"!=typeof t)return!1;try{if(a.call(t),c)try{c.call(t)}catch(t){return!0}return t instanceof o}catch(t){}return!1}},3367:function(t,e,r){"use strict";var n,o="function"==typeof Map&&Map.prototype?Map:null,i="function"==typeof Set&&Set.prototype?Set:null;i||(n=function(t){return!1});var a=o?Map.prototype.has:null,c=i?Set.prototype.has:null;n||c||(n=function(t){return!1}),t.exports=n||function(t){if(!t||"object"!=typeof t)return!1;try{if(c.call(t),a)try{a.call(t)}catch(t){return!0}return t instanceof i}catch(t){}return!1}},3368:function(t,e,r){"use strict";var n=TypeError;t.exports=function(t){if(!t||"function"!=typeof t.next)throw new n("iterator must be an object with a `next` method");if(arguments.length>1){var e=arguments[1];if("function"!=typeof e)throw new n("`callback`, if provided, must be a function")}for(var r,o=e||[];(r=t.next())&&!r.done;)e?e(r.value):o.push(r.value);if(!e)return o}},3369:function(t,e,r){"use strict";var n=r(315),o=r(882),i=r(231),a=r(3305),c=r(3306),s=c(),u=r(3371),p=i("Array.prototype.slice"),l=function(t,e){return o(t),s.apply(t,p(arguments,1))};n(l,{getPolyfill:c,implementation:a,shim:u}),t.exports=l},3370:function(t,e){t.exports=function(t){var e=!0,r=!0,n=!1;if("function"==typeof t){try{t.call("f",(function(t,r,n){"object"!=typeof n&&(e=!1)})),t.call([null],(function(){"use strict";r="string"==typeof this}),"x")}catch(t){n=!0}return!n&&e&&r}return!1}},3371:function(t,e,r){"use strict";var n=r(315),o=r(3306);t.exports=function(){var t=o();return n(Array.prototype,{map:t},{map:function(){return Array.prototype.map!==t}}),t}},3372:function(t,e,r){"use strict";var n=r(3251),o=r(3307),i=r(315);t.exports=function(){n();var t=o();return i(Promise,{allSettled:t},{allSettled:function(){return Promise.allSettled!==t}}),t}}}]);